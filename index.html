<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://code.jquery.com/jquery-3.6.0.js"
            integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>ToDo</title>
</head>
<body>

<div style="width: 800px; margin: auto">
    <h1 style="margin: auto; width: 100px">TODO</h1>
    <input type='text' id='name' placeholder='New Task' style="width: 650px">
    <a href='#' id='add-btn'>Add Task</a>
    <ul id='list' class="list-group">
    </ul>
</div>

<style>
    h1 {
        font-size: 1.5em;
    }

    ul {
        padding: 10px;
        list-style-type: none;
    }

    .done {
        text-decoration: line-through;
    }
</style>
<script>
    $(document).ready(function () {
        let tasks;
        if (localStorage['tasks']) {
            tasks = JSON.parse(localStorage['tasks']);
        } else {
            tasks = [];
        }

        for (let i = 0; i < tasks.length; i++) {
            prependTaskToList(tasks[i]);
        }

        $(document).on('click', '#add-btn', addTask);

        $(document).on('keyup', '#name', function (e) {
            const enterKeyCode = 13;
            if (e.keyCode === enterKeyCode) {
                addTask();
            }
        });


        $(document).on('click', '.done-btn', function () {
            let taskId = $(this).siblings('.id').val();
            tasks.forEach(task => {
                if (task.id == taskId) {
                    task.done = true;
                }
            });
            flushTasksToLocalStorage();
            $(this).closest('li').addClass('done');
        });


        $(document).on('click', '.cancel-btn', function () {
            let taskId = $(this).siblings('.id').val();
            tasks = tasks.filter(task => task.id != taskId);
            flushTasksToLocalStorage()
            $(this).closest('li').fadeOut();
        });

        function getNewTaskId() {
            let totalTasksCount = tasks.length;
            if (totalTasksCount === 0) {
                return 0;
            } else {
                return tasks[totalTasksCount - 1].id + 1;
            }
        }

        function saveTask(task) {
            tasks.push(task);
            flushTasksToLocalStorage();
        }

        function flushTasksToLocalStorage() {
            localStorage["tasks"] = JSON.stringify(tasks);
        }

        function addTask() {
            let input = $('#name').val().trim();
            if (input !== "") {
                let task = {
                    id: getNewTaskId(),
                    value: input,
                    done: false
                };
                saveTask(task)
                prependTaskToList(task);
                $('#name').val("").focus();
            }
        }


        function prependTaskToList(task) {
            $('#list').prepend(`
                    <li class="list-group-item ${task.done == true ? 'done' : ''}">
                        <div class="task">
                            <a href='#' class='done-btn'>Done</a>
                            <a href="#">|</a>
                            <a href='#' class='cancel-btn'>Delete</a>
                            <a href="#">|</a>
                            ${task.value}
                            <input type="hidden" class="id" value='${task.id}'>
                            <input type="hidden" class="done" value='${task.done}'>
                        </div>
                    </li>
        `);
        }
    });
</script>
</body>
</html>