<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <meta charset="UTF-8">
    <title>ToDo</title>
</head>
<body>

<div style="width: 800px; margin: auto">
    <h1 style="margin: auto; width: 100px">TODO</h1>
    <input type='text' id='name' placeholder='New Task' style="width: 650px">
    <a href='#' id='add-btn'>Add Task</a>
    <ul id='list' class="list-group">
    </ul>
</div>

<style>
    h1 {
        font-size: 1.5em;
    }

    ul {
        padding: 10px;
        list-style-type: none;
    }

    .done {
        text-decoration: line-through;
    }
</style>
<script>
    function prependTaskToList(task) {
        $('#list').prepend(`
                    <li class="list-group-item">
                        <div class="task">
                            <a href='#' class='done-btn'>Done</a>
                            <a href="#">|</a>
                            <a href='#' class='cancel-btn'>Delete</a>
                            <a href="#">|</a>
                            ${task.value}
                            <input type="hidden" class="id" value='${task.id}'>
                        </div>
                    </li>
        `);
    }

    if (localStorage['tasks']) {
        tasks = JSON.parse(localStorage['tasks']);
    } else {
        tasks = [];
    }

    for (let i = 0; i < tasks.length; i++) {
        prependTaskToList(tasks[i]);
    }

    function getNewTaskId() {
        let totalTasksCount = tasks.length;
        if (totalTasksCount === 0) {
            return 0;
        } else {
            return tasks[totalTasksCount - 1].id + 1;
        }
    }

    function addTask() {
        let input = $('#name').val().trim();
        console.log(input.length);
        if (input  !== "") {
            let task = {
                id: getNewTaskId(),
                value: input
            };
            tasks.push(task);
            localStorage["tasks"] = JSON.stringify(tasks);
            prependTaskToList(task);
            $('#name').val("").focus();
        }
    }

    $('#add-btn').click(addTask);

    $('#name').keyup(function (e) {
        const enterKeyCode = 13;
        if (e.keyCode === enterKeyCode) {
            addTask();
        }
    });

    $('.done-btn').live('click', function () {
        $(this).closest('li').addClass('done');
    });

    $('.cancel-btn').live('click', function () {
        let taskId = $(this).siblings('.id').val();
        console.log(taskId);
        tasks = tasks.filter(task => task.id != taskId);
        localStorage["tasks"] = JSON.stringify(tasks);
        $(this).closest('li').fadeOut();
    });
</script>
</body>
</html>